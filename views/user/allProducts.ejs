<!-- views/user/allProducts.ejs -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>All Products</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* Page container & global */

     * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }

    body {
      color: #615A5A;
      background: #fff;
    }

    /* Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 60px;
      background: #fff;
    }

    .navbar .logo {
      font-size: 40px;
      font-weight: 37;
      color: #B2A9A1;
    }

    .navbar ul {
      display: flex;
      list-style: none;
      gap: 25px;
    }

    .navbar a {
      text-decoration: none;
      color: #615A5A;
      font-size: 15px;
    }

    .navbar .btn {
      padding: 8px 15px;
      border-radius: 5px;
      background: #484848;
      color: #fff;
    }

    /* Hero */
    .hero {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      padding: 40px 60px;
    }

    .hero img {
      width: 100%;
      border-radius: 8px;
    }

    .hero .center {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .hero h2 {
      font-size: 28px;
      font-weight: bold;
    }

    .hero h2 span {
      font-size: 40px;
    }

    .hero .btn {
      margin-top: 15px;
    }

    /* Categories */
    .categories {
      text-align: center;
      padding: 50px 60px;
    }

    .categories .btn {
      margin: 15px 0;
    }

    .category-list {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    .category img {
      width: 200px;
      border-radius: 8px;
    }

    .category p {
      margin-top: 10px;
      font-weight: bold;
    }

    /* New Arrivals */
    .new-arrivals {
      text-align: center;
      padding: 50px 60px;
    }

    .products {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    .product img {
      width: 220px;
      border-radius: 8px;
    }

    .product h3 {
      font-size: 15px;
      margin: 10px 0 5px;
    }

    .product p {
      font-size: 13px;
      color: #555;
    }

    .product span {
      font-weight: bold;
    }

    /* Footer */
    footer {
      margin-top: 40px;
      background: #f6f6f6;
      padding: 40px 60px;
      color: #666;
    }
     .footer .logo {
      font-size: 60px;
      font-weight: 37;
      color: #B2A9A1;
    }
    .footer-top {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .footer-top h4 {
      margin-bottom: 10px;
      color: #333;
    }

    .footer-top input {
      padding: 8px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .footer-bottom {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
    }
  
    :root{
      --max-w: 1100px;
      --muted: #808080;
      --accent: #111;
      --chip-border: #d3d3d3;
      --line: #e6e6e6;
      --bg: #fff;
      --shadow: 0 6px 18px rgba(17,17,17,0.03);
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%; margin:0; font-family:var(--font-sans); color:#222; background:var(--bg); -webkit-font-smoothing:antialiased;}
    a{color:inherit; text-decoration:none;}
    img{display:block; max-width:100%;}

    .container{
      max-width:var(--max-w);
      margin:40px auto;
      padding:0 20px 70px;
    }

    /* Header area (page title + subtitle + chips) */
    .page-head{
      text-align:center;
      margin-bottom:28px;
    }
    .page-head h2{
      margin:0;
      font-size:28px;
      letter-spacing:1px;
      font-weight:700;
    }
    .page-head p{
      margin:12px 0 18px;
      color:var(--muted);
      font-size:14px;
      max-width:820px;
      margin-left:auto;
      margin-right:auto;
    }

    .chips{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:28px;
    }
    .chip{
      display:inline-block;
      padding:8px 12px;
      border:1px solid var(--chip-border);
      border-radius:6px;
      font-size:13px;
      letter-spacing:0.4px;
      background:#fff;
      transition:all .18s ease;
    }
    .chip.active{
      background:#0f0f0f;
      color:#fff;
      border-color:#0f0f0f;
    }
    .chip:hover{ transform:translateY(-2px); box-shadow:var(--shadow); }

    /* Search + sort row on the right */
    .controls-row{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-bottom:18px;
      align-items:center;
    }
    .controls-row input[type="text"]{
      padding:9px 12px;
      border:1px solid #ddd;
      border-radius:20px;
      min-width:200px;
      font-size:14px;
    }
    .controls-row select{
      padding:9px 12px;
      border:1px solid #ddd;
      border-radius:8px;
      font-size:14px;
      background:#fff;
    }
    .controls-row button{
      padding:9px 12px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      font-size:14px;
    }

    /* Main layout - left sidebar + product area */
    .layout{ display:flex; gap:28px; align-items:flex-start; }
    aside.filters{
      width:240px;
      min-width:190px;
      font-size:13px;
      color:#222;
    }
    .filters .heading{
      font-weight:700;
      margin-bottom:10px;
      letter-spacing:0.6px;
    }

    .filter-block{
      border-bottom:1px solid var(--line);
      padding:14px 0;
    }
    .filter-block label{
      display:block;
      font-weight:600;
      margin-bottom:8px;
      font-size:13px;
    }
    .filter-block select,
    .filter-block input[type="number"]{
      width:100%;
      padding:8px 10px;
      border:1px solid #e0e0e0;
      border-radius:6px;
      font-size:13px;
      box-sizing:border-box;
    }
    .price-row{ display:flex; gap:8px; }
    .price-row input{ flex:1; }

    .apply-btn{
      margin-top:10px;
      display:inline-block;
      padding:8px 12px;
      border-radius:6px;
      border:1px solid #cfcfcf;
      background:#fff;
      cursor:pointer;
      font-size:13px;
    }
    .clear-filters{
      float:right;
      font-size:13px;
      color:var(--muted);
      cursor:pointer;
    }

    /* Products grid */
    .products-wrap{ flex:1; min-width:0; }
    .products-grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:34px 32px;
    }

    .product-card{
      background:transparent;
      border-radius:6px;
      overflow:hidden;
    }
    .product-thumb{
      width:100%;
      height:330px;
      background:#f7f7f7;
      display:block;
      border-radius:4px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,0.03);
    }
    .product-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform:scale(1);
      transition:transform .25s ease;
    }
    .product-card:hover .product-thumb img{ transform:scale(1.03); }

    .product-meta{
      padding-top:12px;
    }
    .product-title{
      font-weight:700;
      font-size:13px;
      letter-spacing:0.4px;
      margin-bottom:6px;
      color:#111;
      text-transform:uppercase;
    }
    .product-desc{
      color:var(--muted);
      font-size:13px;
      margin-bottom:8px;
      min-height:38px;
    }
    .product-price{
      font-weight:800;
      margin-top:6px;
      font-size:15px;
    }

    /* Pager */
    .pager{
      display:flex;
      justify-content:center;
      gap:8px;
      margin-top:26px;
      align-items:center;
      flex-wrap:wrap;
    }
    .pager a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:34px;
      height:34px;
      border-radius:6px;
      border:1px solid #e0e0e0;
      background:#fff;
      text-decoration:none;
      color:#333;
      font-size:13px;
    }
    .pager a.active{
      background:#0f0f0f;
      color:#fff;
      border-color:#0f0f0f;
    }
    .pager a[aria-label="prev"], .pager a[aria-label="next"]{
      width:38px;
      height:34px;
      display:inline-grid;
      place-items:center;
    }

    /* Empty state */
    .no-products{
      grid-column:1/-1;
      text-align:center;
      padding:60px 0;
      color:var(--muted);
    }

    /* Responsive */
    @media (max-width:1100px){
      .container{ margin:24px auto; }
      .products-grid{ gap:22px; grid-template-columns:repeat(2,1fr); }
      aside.filters{ display:none; } /* collapse sidebar for smaller screens */
      .controls-row{ justify-content:space-between; }
    }
    @media (max-width:720px){
      .products-grid{ grid-template-columns:1fr; }
      .controls-row{ flex-wrap:wrap; gap:8px; }
      .chip{ padding:7px 10px; font-size:13px; }
    }
  </style>
</head>
<body>
  <%- include('../partials/user/loggedinHeader') %>

  <div class="container">
    <div class="page-head">
      <h2>ALL PRODUCTS</h2>
      <p>Stock Up Your Fashion Wardrobe Or Test A Fresh 'fit. Shop All Products Here.</p>
    </div>

    <div class="chips" role="tablist" aria-label="categories">
      <a class="chip <%= (!pagination || !pagination.category) ? 'active' : '' %>" href="/products">ALL</a>
      <% if (categories && categories.length) { %>
        <% categories.forEach(function(cat){ %>
          <a class="chip <%= (pagination && String(pagination.category) === String(cat._id)) ? 'active' : '' %>" href="/products?category=<%= cat._id %>"><%= cat.name %></a>
        <% }) %>
      <% } %>
    </div>

    <form method="GET" action="/products" class="controls-row" style="margin-bottom:8px;">
      <input type="text" name="q" placeholder="Search..." value="<%= (pagination && pagination.q) ? pagination.q : '' %>" />
      <select name="sort" onchange="this.form.submit()">
        <option value="newest" <%= (pagination && pagination.sort === 'newest') ? 'selected' : '' %>>Newest</option>
        <option value="price_asc" <%= (pagination && pagination.sort === 'price_asc') ? 'selected' : '' %>>Price: Low to High</option>
        <option value="price_desc" <%= (pagination && pagination.sort === 'price_desc') ? 'selected' : '' %>>Price: High to Low</option>
        <option value="a_z" <%= (pagination && pagination.sort === 'a_z') ? 'selected' : '' %>>A - Z</option>
        <option value="z_a" <%= (pagination && pagination.sort === 'z_a') ? 'selected' : '' %>>Z - A</option>
      </select>

      <input type="hidden" name="category" value="<%= (pagination && pagination.category) ? pagination.category : '' %>" />
      <input type="hidden" name="minPrice" value="<%= (pagination && pagination.minPrice) ? pagination.minPrice : '' %>" />
      <input type="hidden" name="maxPrice" value="<%= (pagination && pagination.maxPrice) ? pagination.maxPrice : '' %>" />
      <input type="hidden" name="limit" value="<%= (pagination && pagination.limit) ? pagination.limit : 9 %>" />

      <button type="submit">Search</button>
    </form>

    <div class="layout">
      <aside class="filters" aria-label="filters">
        <div style="display:flex; align-items:center; margin-bottom:8px;">
          <div class="heading">FILTERS &amp; SORT</div>
          <div class="clear-filters"><a href="/products">Clear</a></div>
        </div>

        <div class="filter-block">
          <form id="categoryFilter" method="GET" action="/products">
            <input type="hidden" name="q" value="<%= (pagination && pagination.q) ? pagination.q : '' %>" />
            <input type="hidden" name="sort" value="<%= (pagination && pagination.sort) ? pagination.sort : '' %>" />
            <input type="hidden" name="limit" value="<%= (pagination && pagination.limit) ? pagination.limit : 9 %>" />
            <label for="categorySelect">Category</label>
            <select id="categorySelect" name="category" onchange="document.getElementById('categoryFilter').submit()">
              <option value="">All</option>
              <% if (categories && categories.length) { %>
                <% categories.forEach(function(cat){ %>
                  <option value="<%= cat._id %>" <%= (pagination && String(pagination.category) === String(cat._id)) ? 'selected' : '' %>><%= cat.name %></option>
                <% }) %>
              <% } %>
            </select>
          </form>
        </div>

        <div class="filter-block">
          <form id="priceFilter" method="GET" action="/products">
            <input type="hidden" name="q" value="<%= (pagination && pagination.q) ? pagination.q : '' %>" />
            <input type="hidden" name="sort" value="<%= (pagination && pagination.sort) ? pagination.sort : '' %>" />
            <input type="hidden" name="category" value="<%= (pagination && pagination.category) ? pagination.category : '' %>" />
            <label>Price range</label>
            <div class="price-row">
              <input type="number" name="minPrice" placeholder="Min" value="<%= (pagination && (typeof pagination.minPrice !== 'undefined')) ? pagination.minPrice : '' %>" />
              <input type="number" name="maxPrice" placeholder="Max" value="<%= (pagination && (typeof pagination.maxPrice !== 'undefined')) ? pagination.maxPrice : '' %>" />
            </div>
            <button class="apply-btn" type="submit">Apply</button>
          </form>
        </div>

        <!-- Additional filter blocks (Size, Color, Fit etc) could be added below using the same .filter-block structure -->
      </aside>

      <main class="products-wrap">
        <div class="products-grid">
          <% if (products && products.length) { %>
            <% products.forEach(function(p){ %>
              <div class="product-card" role="article">
                <a class="product-thumb" href="/product/<%= p._id %>">
                  <% 
                    var img0 = 'placeholder.png';
                    if (p.images && Array.isArray(p.images) && p.images.length) { img0 = p.images[0]; }
                  %>
                  <img src="/uploads/products/<%= img0 %>" alt="<%= p.productName %>" />
                </a>

                <div class="product-meta">
                  <div class="product-title"><%= p.productName %></div>
                  <div class="product-desc">
                     <% if (p.subcategoryName) { %>
                     <%= p.subcategoryName %>
                     <% } else { %>
                     <%= (p.description && p.description.length>60) ? p.description.substring(0,60) + '...' : (p.description || '') %>
                     <% } %>
                   </div>
                  <div class="product-price">
                     <% 
                       // p._price is original min variant price (MRP)
                       // p.minVariantDiscountPrice is min discount price (or null)
                       var mrp = (typeof p._price !== 'undefined' && p._price !== null) ? Number(p._price) : 0;
                       var disc = (typeof p.minVariantDiscountPrice !== 'undefined' && p.minVariantDiscountPrice !== null) ? Number(p.minVariantDiscountPrice) : null;
                     %>
                
                     <% if (disc !== null && disc > 0 && disc < mrp) { %>
                       <span style="font-weight:800;">Rs. <%= disc.toLocaleString('en-IN') %></span>
                       <span style="margin-left:8px;color:#777;text-decoration:line-through;font-weight:600;">Rs. <%= mrp.toLocaleString('en-IN') %></span>
                       <% 
                         var pct = Math.round(((mrp - disc) / mrp) * 100);
                       %>
                       <span style="margin-left:10px;background:#f2f2f2;padding:4px 8px;border-radius:4px;font-size:12px;color:#111;">-<%= pct %>%</span>
                     <% } else { %>
                       <span style="font-weight:800;">Rs. <%= mrp.toLocaleString('en-IN') %></span>
                     <% } %>
                </div>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <div class="no-products">No products found</div>
          <% } %>
        </div>

        <% if (pagination && pagination.totalPages && pagination.totalPages > 1) { %>
          <nav class="pager" role="navigation" aria-label="Pagination">
            <% if (pagination.page > 1) { %>
              <a aria-label="prev" href="/products?page=<%= pagination.page - 1 %>&limit=<%= pagination.limit %>&q=<%= encodeURIComponent(String(pagination.q || '')) %>&sort=<%= pagination.sort || '' %>&category=<%= pagination.category || '' %>&minPrice=<%= pagination.minPrice || '' %>&maxPrice=<%= pagination.maxPrice || '' %>">&lt;</a>
            <% } %>

            <% for (var i = 1; i <= pagination.totalPages; i++) { %>
              <a class="<%= (i === pagination.page) ? 'active' : '' %>" href="/products?page=<%= i %>&limit=<%= pagination.limit %>&q=<%= encodeURIComponent(String(pagination.q || '')) %>&sort=<%= pagination.sort || '' %>&category=<%= pagination.category || '' %>&minPrice=<%= pagination.minPrice || '' %>&maxPrice=<%= pagination.maxPrice || '' %>"><%= i %></a>
            <% } %>

            <% if (pagination.page < pagination.totalPages) { %>
              <a aria-label="next" href="/products?page=<%= pagination.page + 1 %>&limit=<%= pagination.limit %>&q=<%= encodeURIComponent(String(pagination.q || '')) %>&sort=<%= pagination.sort || '' %>&category=<%= pagination.category || '' %>&minPrice=<%= pagination.minPrice || '' %>&maxPrice=<%= pagination.maxPrice || '' %>">&gt;</a>
            <% } %>
          </nav>
        <% } %>
      </main>
    </div>

  </div>

  <%- include('../partials/user/footer') %>
</body>
</html>
