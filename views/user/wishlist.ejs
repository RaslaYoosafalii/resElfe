<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>My Wishlist</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    /* Page container & global */

     * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }

    body {
      color: #615A5A;
      background: #fff;
    }

     /* Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 60px;
      background: #fff;
    }

    .navbar .logo {
      font-size: 40px;
      font-weight: 37;
      color: #B2A9A1;
    }

    .navbar ul {
      display: flex;
      list-style: none;
      gap: 25px;
    }

    .navbar a {
      text-decoration: none;
      color: #615A5A;
      font-size: 15px;
    }

    .navbar .btn {
      padding: 8px 15px;
      border-radius: 5px;
      background: #484848;
      color: #fff;
    }

    /* Hero */
    .hero {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      padding: 40px 60px;
    }

    .hero img {
      width: 100%;
      border-radius: 8px;
    }

    .hero .center {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .hero h2 {
      font-size: 28px;
      font-weight: bold;
    }

    .hero h2 span {
      font-size: 40px;
    }

    .hero .btn {
      margin-top: 15px;
    }

    /* Categories */
    .categories {
      text-align: center;
      padding: 50px 60px;
    }

    .categories .btn {
      margin: 15px 0;
    }

    .category-list {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    .category img {
      width: 200px;
      border-radius: 8px;
    }

    .category p {
      margin-top: 10px;
      font-weight: bold;
    }

    /* New Arrivals */
    .new-arrivals {
      text-align: center;
      padding: 50px 60px;
    }

    .products {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    .product img {
      width: 220px;
      border-radius: 8px;
    }

    .product h3 {
      font-size: 15px;
      margin: 10px 0 5px;
    }

    .product p {
      font-size: 13px;
      color: #555;
    }

    .product span {
      font-weight: bold;
    }

    /* Footer */
    footer {
      margin-top: 40px;
      background: #f6f6f6;
      padding: 40px 60px;
      color: #666;
    }
     .footer .logo {
      font-size: 60px;
      font-weight: 37;
      color: #B2A9A1;
    }
    .footer-top {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .footer-top h4 {
      margin-bottom: 10px;
      color: #333;
    }

    .footer-top input {
      padding: 8px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .footer-bottom {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
    }
    :root{
      --max-w: 1100px;
      --muted: #808080;
      --accent: #111;
      --chip-border: #d3d3d3;
      --line: #e6e6e6;
      --bg: #fff;
      --shadow: 0 6px 18px rgba(17,17,17,0.03);
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%; margin:0; font-family:var(--font-sans); color:#222; background:var(--bg); -webkit-font-smoothing:antialiased;}
    a{color:inherit; text-decoration:none;}
    img{display:block; max-width:100%;}
    body {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
    .container{
      max-width:var(--max-w);
      margin:40px auto;
      padding:0 20px 70px;
      flex: 1;
    }

    /* Header area (page title + subtitle + chips) */
    .page-head{
      text-align:center;
      margin-bottom:28px;
    }
    .page-head h2{
      margin:0;
      font-size:28px;
      letter-spacing:1px;
      font-weight:700;
    }
    .page-head p{
      margin:12px 0 18px;
      color:var(--muted);
      font-size:14px;
      max-width:820px;
      margin-left:auto;
      margin-right:auto;
    }

    .chips{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:28px;
    }
    .chip{
      display:inline-block;
      padding:8px 12px;
      border:1px solid var(--chip-border);
      border-radius:6px;
      font-size:13px;
      letter-spacing:0.4px;
      background:#fff;
      transition:all .18s ease;
    }
    .chip.active{
      background:#0f0f0f;
      color:#fff;
      border-color:#0f0f0f;
    }
    .chip:hover{ transform:translateY(-2px); box-shadow:var(--shadow); }

    /* Search + sort row on the right */
    .controls-row{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-bottom:18px;
      align-items:center;
    }
    .controls-row input[type="text"]{
      padding:9px 12px;
      border:1px solid #ddd;
      border-radius:20px;
      min-width:200px;
      font-size:14px;
    }
    .controls-row select{
      padding:9px 12px;
      border:1px solid #ddd;
      border-radius:8px;
      font-size:14px;
      background:#fff;
    }
    .controls-row button{
      padding:9px 12px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      font-size:14px;
    }

    /* Main layout - left sidebar + product area */
    .layout{ display:flex; gap:28px; align-items:flex-start; }
    aside.filters{
      width:240px;
      min-width:190px;
      font-size:13px;
      color:#222;
    }
    .filters .heading{
      font-weight:700;
      margin-bottom:10px;
      letter-spacing:0.6px;
    }

    .filter-block{
      border-bottom:1px solid var(--line);
      padding:14px 0;
    }
    .filter-block label{
      display:block;
      font-weight:600;
      margin-bottom:8px;
      font-size:13px;
    }
    .filter-block select,
    .filter-block input[type="number"]{
      width:100%;
      padding:8px 10px;
      border:1px solid #e0e0e0;
      border-radius:6px;
      font-size:13px;
      box-sizing:border-box;
    }
    .price-row{ display:flex; gap:8px; }
    .price-row input{ flex:1; }

    .apply-btn{
      margin-top:10px;
      display:inline-block;
      padding:8px 12px;
      border-radius:6px;
      border:1px solid #cfcfcf;
      background:#fff;
      cursor:pointer;
      font-size:13px;
    }
    .clear-filters{
      float:right;
      font-size:13px;
      color:var(--muted);
      cursor:pointer;
    }

    /* Products grid */
    .products-wrap{ flex:1; min-width:0; }
    .products-grid{
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:34px 32px;
    }

    .product-card{
      background:transparent;
      border-radius:6px;
      overflow:hidden;
    }
    .product-thumb{
      width:100%;
      height:330px;
      background:#f7f7f7;
      display:block;
      border-radius:4px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,0.03);
    }
    .product-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform:scale(1);
      transition:transform .25s ease;
    }
    .product-card:hover .product-thumb img{ transform:scale(1.03); }

    .product-meta{
      padding-top:12px;
    }
    .product-title{
      font-weight:700;
      font-size:13px;
      letter-spacing:0.4px;
      margin-bottom:6px;
      color:#111;
      text-transform:uppercase;
    }
  .product-desc{
  color:#808080;
  font-size:13px;
  margin-bottom:8px;
  min-height:38px;
}
.product-price{
  font-weight:800;
  margin-top:6px;
  font-size:15px;
}

    /* Pager */
    .pager{
      display:flex;
      justify-content:center;
      gap:8px;
      margin-top:26px;
      align-items:center;
      flex-wrap:wrap;
    }
    .pager a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:34px;
      height:34px;
      border-radius:6px;
      border:1px solid #e0e0e0;
      background:#fff;
      text-decoration:none;
      color:#333;
      font-size:13px;
    }
    .pager a.active{
      background:#0f0f0f;
      color:#fff;
      border-color:#0f0f0f;
    }
    .pager a[aria-label="prev"], .pager a[aria-label="next"]{
      width:38px;
      height:34px;
      display:inline-grid;
      place-items:center;
    }

    /* Empty state */
    .no-products{
      grid-column:1/-1;
      text-align:center;
      padding:60px 0;
      color:var(--muted);
    }
    .wishlist-btn {
  margin-top: 12px;
  width: 100%;
  padding: 15px;
  background: black;
  color: white;
  border-radius: 30px;
  text-align: center;
  cursor: pointer;
  font-size: 15px;
  border: none;
}

.wishlist-btn.secondary {
  background:white;
  color: black;
  border: 1px black solid;
  border-radius: 10px;
  font-size: 12px;
}


.product-card.disabled .product-thumb {
  pointer-events: none;
  cursor: not-allowed;
}
/* Fade image */
.product-card.disabled .product-thumb img {
  opacity: 0.45;
}

/* Fade product text */
.product-card.disabled .product-title,
.product-card.disabled .product-desc,
.product-card.disabled .product-price {
  opacity: 0.45;
}

/* .unavailable-text {
  font-size: 12px;
  color: #c00;
  margin-top: 6px;
} */
 
/* Fade only product visuals, not actions */
/* .product-card.disabled .product-thumb,
.product-card.disabled .product-meta > :not(.wishlist-btn):not(.unavailable-text) {
  opacity: 0.45;
} */

/* Ensure actions stay fully visible */
.product-card.disabled .wishlist-btn,
.product-card.disabled .unavailable-text {
  opacity: 1;
}
.product-card.disabled .wishlist-btn,
.product-card.disabled .unavailable-overlay {
  opacity: 1;
}
.unavailable-thumb {
  position: relative;
}

.unavailable-thumb img {
  opacity: 0.45;
}

.unavailable-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: last baseline;
  justify-content: left;
  text-align: left;
  font-size: 13px;
  color: #c00;
  background: rgba(255, 255, 255, 0.65);
  padding: 14px;
  line-height: 1;
  pointer-events: none;
}


    /* Responsive */
    @media (max-width:1100px){
      .container{ margin:24px auto; }
      .products-grid{ gap:22px; grid-template-columns:repeat(2,1fr); }
      aside.filters{ display:none; } /* collapse sidebar for smaller screens */
      .controls-row{ justify-content:space-between; }
    }
    @media (max-width:720px){
      .products-grid{ grid-template-columns:1fr; }
      .controls-row{ flex-wrap:wrap; gap:8px; }
      .chip{ padding:7px 10px; font-size:13px; }
    }
  </style>
</head>

<body>
<%- include('../partials/user/loggedinHeader') %>

<div class="container">

  <div class="page-head">
    <h2>MY WISHLIST</h2>
    <p>Saved styles you love. Ready when you are.</p>
  </div>

  <% if (products && products.length) { %>

  <main class="products-wrap">
    <div class="products-grid">

      <% products.forEach(function(p){ %>
        <div class="product-card <%= p.isUnavailable ? 'disabled' : '' %>">

  <% if (!p.isUnavailable) { %>
    <a class="product-thumb" href="/product/<%= p._id %>">
      <img src="/uploads/products/<%= p.images[0] %>" alt="<%= p.productName %>">
    </a>
  
  <% } else { %>
<div class="product-thumb unavailable-thumb">
  <img src="/uploads/products/<%= p.images[0] %>" alt="<%= p.productName %>">
  <div class="unavailable-overlay">
    Product unavailable<br>
    It may have been removed
  </div>
</div>

  <% } %>

          <div class="product-meta">
            <div class="product-title"><%= p.productName %></div>
         
            <div class="product-desc">
              <%= p.subcategoryName || '' %>
            </div>

            <div class="product-price">
              <% 
                const mrp = Number(p._price || 0);
                const disc = p.minVariantDiscountPrice;
              %>

              <% if (disc && disc > 0 && disc < mrp) { %>
                <span>Rs. <%= disc.toLocaleString('en-IN') %></span>
                <span style="margin-left:8px;color:#777;text-decoration:line-through;">
                  Rs. <%= mrp.toLocaleString('en-IN') %>
                </span>
                <% 
                  const pct = Math.round(((mrp - disc) / mrp) * 100);
                %>
                <span style="margin-left:10px;background:#f2f2f2;padding:4px 8px;border-radius:4px;font-size:12px;">
                  -<%= pct %>%
                </span>
              <% } else { %>
                <span>Rs. <%= mrp.toLocaleString('en-IN') %></span>
              <% } %>
            </div>
            <!-- ACTIONS -->

<button class="wishlist-btn secondary"
  onclick="removeFromWishlist('<%= p._id %>')">
  REMOVE FROM WISHLIST
</button>


          </div>
        </div>
      <% }) %>

    </div>
  </main>

  </main>

  <% if (pagination && pagination.totalPages > 1) { %>
    <nav class="pager">
      <% if (pagination.page > 1) { %>
        <a href="/wishlist?page=<%= pagination.page - 1 %>" aria-label="prev">&lt;</a>
      <% } %>

      <% for (let i = 1; i <= pagination.totalPages; i++) { %>
        <a href="/wishlist?page=<%= i %>"
           class="<%= i === pagination.page ? 'active' : '' %>">
          <%= i %>
        </a>
      <% } %>

      <% if (pagination.page < pagination.totalPages) { %>
        <a href="/wishlist?page=<%= pagination.page + 1 %>" aria-label="next">&gt;</a>
      <% } %>
    </nav>
  <% } %>

  <% } else { %>
    <h2 style="margin-top: 100px; text-align: center; font-size: 100px; color: #958989; opacity: 50%;">Your wishlist is empty</h2>
  <% } %>

</div>


</div>
<%- include('../partials/user/footer') %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function removeFromWishlist(productId) {
  fetch('/wishlist/remove', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ productId })
  })
  .then(res => res.json())
  .then(data => {
    if (!data.success) return;
    Swal.fire({
      icon: 'success',
      title: 'Removed from wishlist',
      timer: 1000,
      showConfirmButton: false
    }).then(() => location.reload());
  });
}
</script>
<script>
function moveToCart(productId) {
  // redirect user to product details to select size
  window.location.href = '/product/' + productId;
}
</script>


</body>
</html>